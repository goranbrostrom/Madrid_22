---
title: "A biometric analysis of infant mortality and temperature, northern Sweden 1895-1950"
author: "Göran Broström and Tommy Bengtsson"
date: "`r Sys.Date()`"
output:
  bookdown::pdf_document2:
    citation_package: natbib
    keep_tex: yes
    number_sections: yes
    toc: yes
    toc_depth: 3
  bookdown::word_document2:
    toc: no
    toc_depth: 2
  bookdown::html_document2:
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: yes
citation_package: natbib
classoption: titlepage
bibliography: bio.bib
titlepage: yes
biblio-style: apalike
documentclass: article
fontsize: 11pt
header-includes:
- \usepackage[utf8]{inputenc}
- \usepackage{graphicx}
- \usepackage{a4wide}
- \usepackage[figuresonly]{endfloat}
- \renewcommand{\efloatseparator}{\mbox{}}
abstract: "The effect of extreme temperatures on infant mortality in the Umeå region 1895-1950 is studied in a biometric analysis setting. More precisely, the effect of climate and weather, measured by temperature, is investigated. It turns out that climate is more important than weather, low average temperatures are more important than temporary dips in temperature. The investigated geographical region is situated too far north for bad effects of high temperatures to show."
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.path='figs/',fig.height=3,comment=NA)
library(knitr)
library(eha)
g <- function(x) (log(1 + x))^3 # x in days.
dg <- function(x) (3 * (log(1 + x))^2) / (1 + x)
ginv <- function(y) exp(y^(1/3)) - 1
```

# Introduction

The impact of ambient temperature variations on infant mortality is studied for 
a northern Sweden coastal area, the Umeå and Skellefteå regions, during the 
first half of the twentieth century. Two recent papers [@junkka; @karlsson] studied 
neonatal mortality and climate variations in the same geographical area during the 
years 1880--1950. Climate and mortality in general is a research area that has 
generated great interest over the last years, see @tbgb10.

The effect of seasonal variation and the occurrence of extreme monthly temperatures
is studied and interacted with sex, social class, and legitimacy. Studies are performed 
separately for neonatal  and postneonatal mortality, and for winter and summer seasons, 
and in a joint analysis, the classification into endogenous and exogenous factors will be discussed.

One important reason for studying neonatal and postneonatal mortality separately is the 
findings by Bourgeouis-Pichat [@bp51a;  @bp51b] about endogeneous and exogeneous mortality and the log-cube transform,
so we start by recollecting his results and formulate them in a modern statistical setting.

# The Bourgeouis-Pichat model

Bourgeouis-Picat (*B-P*) suggests that mortality
during the last eleven months (28 days) of infancy follows a *uniform* distribution
given a specific transformation of time (age), the 
*log-cube transformation* $g$. 

\begin{equation*}\label{eq:g}
g(t) = \log^3(1 + t), \quad 0 \le t \le 365,
\end{equation*}

where $t$ is age measured in *days*. 
Its graph is shown in Figure \@ref(fig:figgraph).

```{r figgraph, fig.cap = "The log-cube transform g.", fig.height = 4}
##g <- function(x) (log(1 + x))^3  # Note: days!
x <- seq(0, 365, length = 1000)
y <- g(x)
plot(x, y, type = "l", xlab = "age (days)", ylab = "g(age)", axes = FALSE, 
     col = "blue")
xat <- c(0, 28, 183, 365)
yat <- g(xat)
axis(1, at = xat)
axis(2, at = yat, labels = round(yat, 1), las = 1)
box()
lines(c(28, 28), c(0, g(28)), lty = 2, col = "darkgreen")
lines(c(0, 28), c(g(28), g(28)), lty = 2, col = "darkgreen")
##
lines(c(183, 183), c(0, g(183)), lty = 2, col = "darkgreen")
lines(c(0, 183), c(g(183), g(183)), lty = 2, col = "darkgreen")
##
lines(c(365, 365), c(0, g(365)), lty = 2, col = "darkgreen")
lines(c(0, 365), c(g(365), g(365)), lty = 2, col = "darkgreen")
abline(h = 0, v = 0)
##abline(a = 0, b = 1, col = "red")
```

The *B-P* model specifies that, on the transformed age scale, the *exogeneous*
mortality distribution, conditional on death before age 365 days,  is *uniform*, that is, the 
survivor function of $T$ is *linear*,

\begin{equation}
S(t) = 1 - \alpha t, \, 0 \le t \le g(365).
\end{equation}

Furthermore, it is assumed that the *endogeneous* component is non-zero only during the first
month of life.

Next we apply the model to our infant mortality data from the Umeå-Skellefteå region.

## Infant mortality, a first look

```{r readdata}
infdat <- readRDS("data/infdat3.rds")
```

From the Umeå-Skellefteå region, we follow all persons born in the 
region 1895--1950 until death, reaching the age of 1 year, or leaving follow-up for whatever 
reason, whichever comes first. The first few lines (infants) are shown in Table 
\@ref(tab:infdat3). Note that covariates are left out for the time being.

If `event == TRUE`, then the infant died at age (in days) given by `exit`, otherwise
the infant survived (at least) 365 days and follow-up is lost at `exit == 365`. 
So, in Table \@ref(tab:infdat3), infants No. 1--4 survived, 
while infant No. 5 died at age 162 days. We assume here that all infants are followed from birth,
that is, `enter == 0` in all cases (no left truncation).

```{r infdat3}
source("R/tbl.R")
sinf <- infdat[, c("enter", "exit", "event")]
x <- head(sinf, 4)
y <- sinf[sinf$event == 1, ][1, ]
z <- rbind(x, y)
z$id <- 1:5
z <- z[, c("id", "enter", "exit", "event")]
tbl(z, caption = "A few infants in the data set.")
```


### The Bourgeois-Pichat procedure

The BP procedure consists of three steps:

1.   Order the data set ascending by `exit`,

2.   apply the log-cube transformation to the age data, and

3.   plot the cumulative sum of the number of deaths vs. age.

The result is shown in Figure \@ref(fig:ggplot2), together with the original
data.  The transform data is stretced  stretched to 365 for easier comparison.

```{r ggplot2, fig.cap = "BB plots with and without time transform, Umeå-Skellefteå 1895-1950."}
nbths <- NROW(infdat)
##oldpar <- par(mfrow = c(2, 1))
sur <- with(infdat, Surv(enter, exit, event))
rs <- risksets(sur)
ss <- cumsum(rs$n.events)
## Natural:
xt <- rs$risktimes
att <- c(0, 28, 183, 365)
plot(xt, ss / nbths, ylim = c(0, max(ss / nbths)), type = "l",
     axes = FALSE, col = "blue", lwd = 2, xlab = "Age (days)",
     ylab = "Cum. deaths")
abline(h = 0)
axis(2, las = 1)
axis(1, at = att, labels = att)
box()
## g-transformed:
lines(g(xt) / g(365) * 365, ss / nbths, 
     col = "red", lwd = 2, xlab = "Age (days)", lty = 2)
##abline(h = 0)
##axis(2, las = 1)
axis(3, at = g(att) / g(365) * 365, labels = att, col = "red", lty = 2)
box()
abline(v = 0)
abline(v = g(c(28, 183, 365)) / g(365) * 365, col = "red", lty = 3)
abline(v = c(28, 183, 365), col = "blue", lty = 3)
##
legend("bottomright", legend = c("Natural", "g-transform"), col = c("blue", "red"), lty = 1)
abline(h = (ss / nbths) [28], lty = 3 )
abline(h = (ss / nbths) [180], lty = 3 )
##par(oldpar)
```

The curves are the empirical *cumulative distribution function (CDF)* expressed 
on the two scales, that is, one minus the *Kaplan-Meier [@km58] estimates* of the 
*survivor functions*.

### Postneonatal mortality

We begin by studying mortality after age 28 days on the $g$-scale, *B-P* predicts that it is approximately *uniform*. 
The uniform distribution, however, is not very useful in a survival analysis context, so we will
investigate a close alternative, the *exponential * distribution. Modifying the *B-P* plot by using successive 
divisions by current *risk set size* instead of original sample size should result in an approximately linear graph if the 
exponential assumption is valid.

```{r pneo, fig.cap = "Relation between cumulative hazards and CDF for transformed postneonatal mortality data."}
ginfdat <- age.window(infdat, c(28, 365))
ginfdat$enter <- g(ginfdat$enter)
ginfdat$exit <- g(ginfdat$exit)
grs <- risksets(with(ginfdat, Surv(enter, exit, event)), members = FALSE)
fit <- coxreg(Surv(enter, exit, event) ~ 1, data = ginfdat)
ser <- plot(fit, fn = "sur", fig = FALSE)
##plot(fit, col = "blue", axes = FALSE)
cum <- fit$hazards[[1]]
x <- cum[, 1]
ch <- cumsum(cum[, 2])
plot(x, ch, type = "s", axes = FALSE, col = "blue", xlab = "Age (days)", ylab = "")
axis(1, at = c(g(28), g(183), g(365)), labels = c(28, 183, 365))
axis(2, las = 1)
abline(h = 0)
box()
x <- ser[[1]][[1]][, 1]
y <- ser[[1]][[1]][, 2]
lines(x, 1 - y, col = "red", lty = 2)
legend("topleft", legend = c("Cumulative hazards", "CDF (Bourgeouis-Pichat)"), col = c("blue", "red"),
       lty = c(1, 2))
```

As is evident from Figure \@ref(fig:pneo), the difference between the the two curves is
negligible, and both are well approximated by a straight line, so we will from now on work with the 
assumption that the transformed postneonatal data are *exponentially distributed*.
There is also a mathematical argument motivating the similarity: The cdf for an exponentially 
distributed random variable $T$ is

\begin{equation*}
F_T(t) = 1 - \exp(-\lambda t), \quad t, \lambda > 0, 
\end{equation*}

and the first order approximation of this expression is

\begin{equation*}
F_T(t) \approx \lambda t, \quad t, \lambda > 0,
\end{equation*}

which is the *cumulative hazards* function of $T$,
and the approximation is good for small values of $\lambda t$.

So, the *hazard function* (which is the slope of the lines in Figure \@ref(fig:pneo))
is simply estimated by the ratio of the *number of deaths* to the *total time of exposure*
(an *occurrence/exposure* rate):

```{r simpest, echo = TRUE}
posthaz <- with(ginfdat, sum(event) / sum(exit - enter))
```

which evaluates to `r format(posthaz, digits = 3, scientific = TRUE)`. A small number, but remember
that the time unit is defined on the scale defined by the function $g$ (close to *day*).

### Neonatal mortality

Is the sum of two components, *external* and *internal* causes. According to the *B-P*
theory, the external component is equal to the postneonatal mortality, which contains 
only an external component. 

We create the neonatal data set by censor all lives at the age 28:

```{r neon, echo = TRUE}
neo <- age.window(infdat, c(0, 28))
neo$enter <- g(neo$enter)
neo$exit <- g(neo$exit)
```

and then fit a piecewise constant hazards model with cutpoints at $g(0, 2, 4, 7, 11, 16, 22, 28)$, see 
Figure \@ref(fig:pchneo).

```{r pchneo, fig.cap = "Neonatal hazard function with external component (dashed).", fig.height = 3}
neocuts <- g(c(0, 2, 4, 7, 11, 16, 22, 28))
fitneo <- pchreg(Surv(enter, exit, event) ~ 1, data = neo, cuts = neocuts)
plot(fitneo, fn = "haz", col = "blue", main = "", xlab = "g(days)", axes = FALSE)
axis(1)
axis(2, las = 1)
box()
abline(h = 0, v = 0)
abline(h = posthaz, col = "red", lty = 2)
```

Let us take a closer look at what happens at the end of the neonatal interval, see 
Figure \@ref(fig:pchneo2). It shows a smooth transition towards the postneonatal 
(external) mortality.

```{r pchneo2, fig.cap = "Neonatal hazard function with external component (dashed), right hand tail.", fig.height = 3}
##fitneo <- pchreg(Surv(enter, exit, event) ~ 1, data = neo, cuts = neocuts)
par(las = 1)
plot(fitneo, fn = "haz", col = "blue", main = "", xlab = "g(days)", xlim = c(5, 39))
abline(h = 0, v = 0)
abline(h = posthaz, col = "red", lty = 2)
```


### Putting all together

Looking at the full infant mortality interval on the $g$-scale, we have a piecewise 
constant hazards model with cutpoints at $g(0, 1, 2, 4, 7, 11, 16, 22, 28)$, see 
Figure \@ref(fig:together) (where the value close to zero is truncated).

```{r together, fig.cap = "Hazard function, infant mortality, transformed time."}
allcuts <- c(neocuts, g(365))
ginfdat <- infdat
ginfdat$exit <- g(ginfdat$exit)
fitall <- pchreg(Surv(enter, exit, event) ~ 1, data = ginfdat, cuts = allcuts)
plot(fitall, fn = "haz", col = "blue", main = "", xlab = "g(Days)", axes = FALSE,
     ylim = c(0, 0.002))
pcuts <- g(c(0, 28, 183, 365))
axis(1, at = pcuts, labels = round(pcuts))
axis(2, las = 1)
box()
abline(h = 0, v = 0)
```

Now we would like to see the content of Figure \@ref(fig:together) on the natural time 
scale. If $Y = g(T)$, we have the relation between their respective hazard functions

\begin{equation*}
h_T(t) = \frac{d}{dt} g(t) h_Y\bigl(g^{-1}(t)\bigr), \quad 0 \le t \le 365,
\end{equation*}

and with $h_Y$ shown in Figure \@ref(fig:together), we get $h_T$ in Figure 
\@ref(fig:allnorm) **(must be checked!)**.

```{r allnorm, fig.cap = "Hazard function, infant mortality, natural time scale."}
y <- hazards(fitall, cum = FALSE, n.points = 3000)$x
hy <- hazards(fitall, cum = FALSE, n.points = 3000)$y
te <- ginv(y)
hte <- dg(te) * hy
plot(te, hte, type = "s", col = "blue", xlab = "Days", ylab = "", axes = FALSE,
     ylim = c(0, 0.002)) 
     ##xlim = c(0, 28))
axis(1, at = ginv(pcuts))
axis(2, las = 1)
box()
abline(h = 0, v = 0)
```




# Data



## Infant mortality, summary graphs

Figure \@ref(fig:mortstat) shows the average monthly crude infant mortality, and a clear seasonal pattern is visible.

```{r mortstat, fig.cap = "Crude infant mortality by week of year, Umeå/Skellefteå 1895--1950."}
infdat <- readRDS("data/infdat3_year3.rds")
tid <- toTpch(Surv(enter, exit, event) ~ week, data = infdat, cuts = c(0, 1))
y <- tid$event / tid$exposure
plot(1:52, y, type = "b", col = "blue", axes = FALSE, ylim = c(0, max(y)),
     xlab = "Week", ylab = "IMR")
axis(1, at = c(1, 10, 20, 30, 40, 52))
axis(2, las = 1, at = c(0, 0.03, 0.06, 0.09))
abline(h = c(0.05, 0.07, 0.09, 0.11), lty = 3)
abline(h = 0)
box()
```

The average monthly neonatal mortality is shown in Figure \@ref(fig:neodata).

```{r neodata, fig.cap = "Crude neonatal mortality by week of year, Umeå/Skellefteå 1895--1950."}
neo <- age.window(infdat, c(0, 28 / 365))
tneo <- toTpch(Surv(enter, exit, event) ~ week, data = neo, cuts = c(0, 28 / 365))
y <- tneo$event / tneo$exposure
plot(1:52, y, type = "b", col = "blue", axes = FALSE, ylim = c(0, max(y)),
     xlab = "Week", ylab = "NMR")
axis(1, at = c(1, 10, 20, 30, 40, 52))
axis(2, las = 1, at = c(0, 0.2, 0.4, 0.6))
abline(h = c(0.3, 0.4, 0.5, 0.6), lty = 3)
abline(h = 0)
box()
```

The seasonal pattern is similar to the one we found above for infant mortality.

The average monthly postneonatal mortality is shown in Figure \@ref(fig:pneodata).

```{r pneodata, fig.cap = "Crude postneonatal mortality by week of year, Umeå/Skellefteå 1895--1950."}
pneo <- age.window(infdat, c(28 / 365, 1))
tpneo <- toTpch(Surv(enter, exit, event) ~ week, data = pneo, cuts = c(28 / 365, 1))
y <- tpneo$event / tpneo$exposure
plot(1:52, y, type = "b", col = "blue", axes = FALSE, ylim = c(0, max(y)),
     xlab = "Week", ylab = "PNMR")
axis(1, at = c(1, 10, 20, 30, 40, 52))
axis(2, at = c(0, 0.02, 0.04, 0.06), las = 1)
abline(h = c(0.03, 0.04, 0.05, 0.06, 0.07), lty = 3)
abline(h = 0)
box()
```

The seasonal pattern is once again similar to the one we found for infant mortality.
Next, the decline over the years in Figures \@ref(fig:longtrend) and \@ref(fig:ntrend).

```{r longtrend, fig.cap = "Crude IMR by year, Umeå-Skellefteå 1895--1950.", fig.height = 4}
trend <- toTpch(Surv(enter, exit, event) ~ year, data = infdat, cuts = c(0, 1))
y <- trend$event / trend$exposure
par(las = 1)
plot(1895:1951, y, type = "b", col = "blue", ylim = c(0, max(y)), xlab = "Year",
     ylab = "IMR")
abline(h = 0)
```


```{r ntrend, fig.cap = "Crude NMR by year, Umeå-Skellefteå 1895--1950.", fig.height = 4}
ndat <- age.window(infdat, c(0, 28 / 365))
tnda <- toTpch(Surv(enter, exit, event) ~ year, data = ndat, cuts = c(0, 28 / 365))
y <- tnda$event / tnda$exposure
par(las = 1)
plot(1895:1951, y, type = "b", col = "blue", ylim = c(0, max(y)), xlab = "Year",
     ylab = "NMR")
abline(h = 0)
```

## Temperature

```{r readtemp}
umetemp <- readRDS("data/umetemp.rds")
bjurtemp <- readRDS("data/bjurtemp.rds")
```

Temperature data are collected from two weather stations, *Umeå* and *Bjuröklubb*
(used with population data from Skellefteå coastal area). Both stations deliver
daily temperature data covering our time period, usually three measures per day, morning,
noon, and evening. Weekly averages are calculated year by year, and deviations from 
the averages of the weekly averages are used as a time-varying *communal covariate*. See Figure 
\@ref(fig:monavgtemp) for the monthly distributions.

```{r monavgtemp, fig.cap="Weekly max and min temperature averages, 1895--1950."}
oldpar <- par(mfrow= c(1, 2))
## Umeå:
umaxavg <- umetemp$emaxtemp[1:52]
uminavg <- umetemp$emintemp[1:52]
plot(1:52, umaxavg, ylim = c(-20, 30), type = "b", col = "red", axes = FALSE,
     xlab = "Week", ylab = "Temperature (C)")
text(17, 27, "Umeå")
axis(1, at = c(1, 10, 29, 43, 52))
axis(2, las = 1)
abline(h = 0)
abline(v = 29, lty = 3)
abline(h = c(-20, -10, 10, 20), lty = 3)
lines(1:52, uminavg, type = "b", col = "blue")
text(8, 11, "max", col = "red")
text(20, -9, "min", col = "blue")
box()
## Skellefteå:
bmaxavg <- bjurtemp$emaxtemp[1:52]
bminavg <- bjurtemp$emintemp[1:52]
plot(1:52, bmaxavg, ylim = c(-20, 30), type = "b", col = "red", axes = FALSE,
     xlab = "Week", ylab = "Temperature (C)")
text(17, 27, "Skellefteå")
axis(1, at = c(1, 10, 29, 43, 52))
axis(2, las = 1)
abline(h = 0)
abline(v = 29, lty = 3)
abline(h = c(-20, -10, 10, 20), lty = 3)
lines(1:52, bminavg, type = "b", col = "blue")
text(8, 11, "max", col = "red")
text(20, -9, "min", col = "blue")
box()
##
par(oldpar)
```

# Infant mortality, climate and weather

The analyses are performed on the log-cube scale with proportional hazards modelling. Note that
the property of proportional hazards are preserved under a strictly monotone increasing time transform.
However, the estimates of baseline distribution characteristics will change, of course.

We start by performing separate analyses for neonatal and postneonatal mortality. Then we make comparisons.

## Postneonatal mortality

This is the simplest part, because *B-P* predicts that the baseline distribution (given the log-cube
transformation) is *exponential*, that is, the hazard function is *constant*.

```{r postanal, results='asis'}
infdat$parity <- cut(infdat$parity, c(-2, 1.5, 4.5, 19), labels = c("1", "2-4", "5+"))
infdat$period <- cut(infdat$birthdate, c(1895, 1914, 1935, 1951))
levels(infdat$subreg) <- c("ume", "ske")
infdat$season <- cut(infdat$week, c(-1, 9.5, 22.5, 35.5, 48.5, 52.5), labels = c("winter", "spring", "summer", "fall", "winter"))
infdat$season <- as.factor(infdat$season)
pneo <- age.window(infdat, c(28 / 365, 1))
##
pneo$enter <- g(pneo$enter * 365)
pneo$exit <- g(pneo$exit * 365)
##
pneo$emintemp <- round(pneo$emintemp)
##
tpneo <- toTpch(Surv(enter, exit, event) ~ sex + socBranch + socStatus + illeg + parity + 
                    period + cold
                + emintemp + season + subreg, 
                data = pneo, cuts = g(c(28, 365)))
##fit2 <- phreg(Surv(enter - g(28), exit - g(28), event) ~ sex + socBranch + socStatus + cold + emintemp, 
  ##           data = pneo, shape = 1)
##fit.pch <- pchreg(Surv(enter, exit, event) ~ sex + socBranch + socStatus + cold + emintemp, 
  ##           data = pneo, cuts = g(c(28, 365)))
fit.tpch <- tpchreg(oe(event, exposure) ~ sex + socBranch + socStatus + illeg + parity +
                        period + cold + emintemp + season + subreg, 
                    data = tpneo, time = age)
dr <- drop1(fit.tpch, test = "Chisq")
ltx(fit.tpch, dr = dr, caption = "Postneonatal mortality.", label = "tab:postanal")
```

The result in Table \@ref(tab:postanal) shows that *climate* (`emintemp`) is more important than 
*weather* (`cold`). Moreover, no signs of interaction between weather or climate and the rest of 
covariates (not shown).

## Neonatal mortality

It turns out that here we have some significant interactions, with `sex` involved.
Maybe surprising. So we run separate analyses for the sexes.

### Girls

```{r neoanal, results = 'asis'}
neo <- age.window(infdat, c(0, 28 /365))
neo$exit <- g(neo$exit * 365)
neo$enter <- g(neo$enter * 365)
fit.ph <- coxreg(Surv(enter, exit, event) ~  socStatus + illeg + parity + period + socBranch  + cold + emintemp + subreg + season,
                 data = neo[neo$sex == "girl", ])
dr <- drop1(fit.ph, test = "Chisq")
ltx(fit.ph, dr = dr, caption = "Neonatal mortality, girls.", label = "tab:neonatal")
```

Same here, *climate* is more important than *weather*.

### Boys

```{r neoanalboys, results = 'asis'}
fit.ph <- coxreg(Surv(enter, exit, event) ~  socStatus + illeg + parity + period + socBranch  + cold + emintemp + subreg + season,
                 data = neo[neo$sex == "boy", ])
dr <- drop1(fit.ph, test = "Chisq")
ltx(fit.ph, dr = dr, caption = "Neonatal mortality, boys.", label = "tab:neonatalboys")
```

Here, however, boys are sensitive to temperatures below average, in addition to the 
sensitivity for cold climate.

## Postneonatal mortality, winter and spring

This is the simplest part, because *B-P* predicts that the baseline distribution (given the log-cube
transformation) is *exponential*, that is, the hazard function is *constant*.

```{r postanalw, results='asis'}
##infdat$parity <- cut(infdat$parity, c(-2, 1.5, 4.5, 19), labels = c("1", "2-4", "5+"))
##levels(infdat$subreg) <- c("ume", "ske")
##infdat$season <- cut(infdat$week, c(-1, 9.5, 22.5, 35.5, 48.5, 52.5), labels = c("winter", "spring", "summer", "fall", "winter"))
##infdat$season <- as.factor(infdat$season)
pneo <- age.window(infdat[infdat$season %in% c("winter", "spring"), ], c(28 / 365, 1))
##
pneo$enter <- g(pneo$enter * 365)
pneo$exit <- g(pneo$exit * 365)
##
pneo$emintemp <- round(pneo$emintemp)
##
tpneo <- toTpch(Surv(enter, exit, event) ~ sex + socBranch + socStatus + illeg + parity + 
                    cold + emintemp + period + subreg, 
                data = pneo, cuts = g(c(28, 365)))
##fit2 <- phreg(Surv(enter - g(28), exit - g(28), event) ~ sex + socBranch + socStatus + cold + emintemp, 
  ##           data = pneo, shape = 1)
##fit.pch <- pchreg(Surv(enter, exit, event) ~ sex + socBranch + socStatus + cold + emintemp, 
  ##           data = pneo, cuts = g(c(28, 365)))
fit.tpch <- tpchreg(oe(event, exposure) ~ sex + socBranch + socStatus + illeg + parity + period + 
                        cold + emintemp + subreg, 
                    data = tpneo, time = age)
dr <- drop1(fit.tpch, test = "Chisq")
ltx(fit.tpch, dr = dr, caption = "Postneonatal mortality, winter and spring.", label = "tab:postanalw")
```

The result in Table \@ref(tab:postanalw) shows that *climate* (`emintemp`) is more important than 
*weather* (`cold`). Moreover, no signs of interaction between weather or climate and the rest of 
covariates (not shown).

## Neonatal mortality, winter and spring

It turns out that here we have some significant interactions, with `sex` involved.
Maybe surprising. So we run separate analyses for the sexes.

### Girls

```{r neoanalw, results = 'asis'}
neo <- age.window(infdat[infdat$season %in% c("winter", "spring"), ], c(0, 28 /365))
neo$exit <- g(neo$exit * 365)
neo$enter <- g(neo$enter * 365)
fit.ph <- coxreg(Surv(enter, exit, event) ~  socStatus + illeg + parity + period + socBranch  + cold + emintemp + subreg,
                 data = neo[neo$sex == "girl", ])
dr <- drop1(fit.ph, test = "Chisq")
ltx(fit.ph, dr = dr, caption = "Neonatal mortality winter and spring, girls.", label = "tab:neonatalw")
```

Same here, *climate* is more important than *weather*.

### Boys

```{r neoanalboysw, results = 'asis'}
fit.ph <- coxreg(Surv(enter, exit, event) ~  socStatus + illeg + parity + period + socBranch  + cold + emintemp + subreg,
                 data = neo[neo$sex == "boy", ])
dr <- drop1(fit.ph, test = "Chisq")
ltx(fit.ph, dr = dr, caption = "Neonatal mortality winter and spring, boys.", label = "tab:neonatalboysw")
```

Here, however, boys are sensitive to temperatures below average, in addition to the 
sensitivity for cold climate.

# Conclusion

Remains to be written. Feels like two papers, one about Bourgeouis-Pichat and one
about climate and weather. Maybe discuss exogeneity/endogeneity?
