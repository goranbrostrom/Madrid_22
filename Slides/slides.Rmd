---
output:
  beamer_presentation:
    keep_tex: true  
    fig_caption: no
    fig_width: 5
    includes:
      before_body: gb_beforebody.txt
      in_header: gb_header.txt
  ioslides_presentation: default
  slidy_presentation: default
fontsize: 16pt  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, fig.width = 11, warning = FALSE, comment = NA)

library(eha)
par(cex.axis = 1.2)
```

## Outline

*   The impact of ambient \emp{temperature variations on infant mortality} in \emp{Umeå-Skellefteå} 
regions.

*   Temperature with two components:
    +   \emp{Expected temperature} or climate (given time of the year).
    +   \emp{Marginal temperature} a given week a given year: *observed minus expected* temperature.
*   Are the \emp{effects} of expected and marginal \emp{different by}
    +   \emp{Social class?}
    +   Neonatal and postneonatal \emp{age periods?}


## Earlier on weather and mortality

*   \emp{Neonatal mortality}: Junkka et al. (2021), Karlsson et al. (2021). Same area and time period.
*   \emp{Mortality general:} Rocklöv et al. (2014), Rogers (1928), Bengtsson (1993, 2004),
Bengtsson and Broström (2010)


## Study area

\includegraphics[width=0.9\textwidth]{myfigs/map2.png}


## Temperature data 1--7 January 1923, Umeå

```{r tempdat, fontsize = 'small'}
tum <- read.table("~/Forskning/Data/ume_temp.csv", skip = 10, sep = ";", header = TRUE)
source("../R/tbl.R")
ww <- tum[70137:(70137 + 20), ]
names(ww) <- c("Date", "Time", "Temp", "Quality")
```

\begin{columns}

\column{0.5\textwidth}

```{r}
tbl(ww[1:12, ], fs = 7, caption = NULL,
   linesep = c("", "", "\\addlinespace"))
```

\column{0.5\textwidth}

```{r}
tbl(ww[13:21, ], fs = 7, caption = NULL,
   linesep = c("", "", "\\addlinespace"))
```


\end{columns}

52 weeks per year, 56 years = 2912 weekly means.

## Temperature variables

*   **Temp**: Mean temperatures by week and year.
*   **expTemp**: Mean of **Temp** for each week (over all years, *seasonality*).
*   **margTemp**: **Temp** - **expTemp** (short term variation).

**expTemp** and **margTemp** are used in the analyses.

## Temperature variations

\emp{expTemp} (one period):

\begin{center}
\includegraphics[width=0.8\textwidth]{figs/monavgtemp-1.pdf} 
\end{center}

\emp{margTemp} (Umeå):

```{r margum, fig.height = 4}
umetemp <- readRDS("~/Forskning/Madrid_22/Slides/data/umetemp.rds")
ut <- umetemp[umetemp$year %in% 1895: 1950, ]
plot(1:nrow(ut), ut$extemp, type = "l", col = "blue", 
                   ylab = "Temp", xlab = "Year and Week", axes = FALSE)
axis(1, at = seq(1, nrow(ut), by = 52), labels = 1895:1950)
axis(2, las = 1)
box()
abline(v = seq(1, nrow(ut), by = 52), lty = 3)
abline(h = 0, col = "red")


```


## Neonatal and postneonatal mortality by week

\emp{Neonatal:}

\begin{center}
\includegraphics[width=0.8\textwidth]{figs/neodata-1.pdf}
\end{center}

\emp{Postneonatal:}

\begin{center}
\includegraphics[width=0.8\textwidth]{figs/pneodata-1.pdf}
\end{center}  
  
## Infant mortality data

From \emp{Centre for Ageing and Demographic Research}, Umeå University.

## Merging of temperature and mortality data

Use the function \emp{make.communal} in the **R** package \emp{eha}.

Result for infant No. 1226 (selected variables):

```{r communal}
source("R/tbl.R")
infdat <- readRDS("data/infdat4.rds")
ifd <- infdat[, c("id", "enter", "exit", "event", "socst", "urban", "extemp.1", "emeantemp.1", "year", "week")]
ifd$event <- as.logical(ifd$event)
ifd$expT <- round(ifd$emeantemp.1)
ifd$margT <- round(ifd$extemp.1)
ifd$extemp.1 <- ifd$emeantemp.1 <- NULL
ifd$enter <- round(ifd$enter * 365)
ifd$exit <- round(ifd$exit * 365)
tbl(head(ifd[ifd$id == 1226, ], 10), rownames = FALSE, fs = 7, caption = NULL)
```

\emp{Weeks:} 1 = 1--7 Jan, \ldots, week 52 = 24(23) - 31 Dec. \emp{Every year!}
    
## Variables in regression analyses

*   **expTemp** (time varying) expected temperature given week number.
*   **marginTemp** (time varying) Observed week temperature minus expTemp.
*   **socst** Social status:
     + *highWhiteC* Upper white collar
     + *farmer*
     + *lowWhiteC* Lower white collar
     + *qualWorker* Qualified worker
     + *worker* Unqualified worker
     + *none* No notation (for instance unmarried mother)
*   **sex** Boy or girl
*   **urban** Small town (Umeå or Skellefteå) or not (logical)
*   **parity** Birth order
*   **year**  (time varying)


## Postneonatal mortality, winter (weeks 40--52, 1--13)

\footnotesize 
\begin{tabular}{lrrrrr} 
\hline 
\bf Covariate & \bf Mean & \bf Coef & \bf H.R. & \bf S.E. &   \bf L-R p \\ \hline
\empp{expTemp}  & $    -3.763  $ & $  -0.046  $ & \empp{$  0.955  $} & $  0.005  $ & $ 0.000 $ \\ 
\empp{marginTemp}  & $     0.018  $ & $  -0.017  $ & \empp{$  0.983  $} & $  0.005  $ & $ 0.000 $ \\ 
\empp{socst}  & & & & & 0.000  \\ 
\multicolumn{1}{r}{\em highWhiteC} &    0.030 & 0 & 1 & \multicolumn{2}{c}{(reference)} \\ 
\multicolumn{1}{r}{ \em farmer }  & $    0.464 $ & $ 0.836 $ & $ 2.308 $ & $ 0.219 $\\ 
\multicolumn{1}{r}{ \em lowWhiteC }  & $    0.078 $ & $ 0.785 $ & $ 2.192 $ & $ 0.230 $\\ 
\multicolumn{1}{r}{ \em qualWorker }  & $    0.134 $ & $ 0.947 $ & $ 2.579 $ & $ 0.222 $\\ 
\multicolumn{1}{r}{ \em worker }  & $    0.270 $ & $ 1.047 $ & $ 2.848 $ & $ 0.219 $\\ 
\multicolumn{1}{r}{ \em none }  & $    0.025 $ & $ 1.003 $ & $ 2.727 $ & $ 0.253 $\\ 
urban  & & & & & 0.642  \\ 
\multicolumn{1}{r}{\em FALSE} &    0.860 & 0 & 1 & \multicolumn{2}{c}{(reference)} \\ 
\multicolumn{1}{r}{ \em TRUE }  & $    0.140 $ & $ 0.035 $ & $ 1.036 $ & $ 0.076 $\\ 
I(year - 1920)  & $     3.267  $ & $  -0.024  $ & $  0.976  $ & $  0.001  $ & $ 0.000 $ \\ 
\hline 
Events &  2346  & TTR &  46214 \\ 
Max. logLik. & $  -25069  $ \\ \hline 
\hline 
\end{tabular}

## Interactions postneonatal, winter

Interactions between socst and expTemp:


\includegraphics[width=0.8\textwidth]{figs/plotwcs-1.pdf}


Interactions between socst and marginTemp:


\includegraphics[width=0.8\textwidth]{figs/plotwws-1.pdf}

## Postneonatal mortality, summer

\footnotesize
\begin{tabular}{lrrrrr} 
\hline 
\bf Covariate & \bf Mean & \bf Coef & \bf H.R. & \bf S.E. &   \bf L-R p \\ \hline
\empp{expTemp}  & $     9.578  $ & $  -0.019  $ & \empp{$  0.981  $} & $  0.004  $ & $ 0.000 $ \\ 
marginTemp  & $     0.003  $ & $  -0.011  $ & $  0.989  $ & $  0.010  $ & $ 0.259 $ \\ 
\empp{socst}  & & & & & 0.000  \\ 
\multicolumn{1}{r}{\em highWhiteC} &    0.030 & 0 & 1 & \multicolumn{2}{c}{(reference)} \\ 
\multicolumn{1}{r}{ \em farmer }  & $    0.464 $ & $ 0.744 $ & $ 2.105 $ & $ 0.231 $\\ 
\multicolumn{1}{r}{ \em lowWhiteC }  & $    0.078 $ & $ 0.605 $ & $ 1.831 $ & $ 0.245 $\\ 
\multicolumn{1}{r}{ \em qualWorker }  & $    0.133 $ & $ 0.678 $ & $ 1.971 $ & $ 0.236 $\\ 
\multicolumn{1}{r}{ \em worker }  & $    0.270 $ & $ 0.988 $ & $ 2.686 $ & $ 0.230 $\\ 
\multicolumn{1}{r}{ \em none }  & $    0.025 $ & $ 0.903 $ & $ 2.467 $ & $ 0.268 $\\ 
urban  & & & & & 0.936  \\ 
\multicolumn{1}{r}{\em FALSE} &    0.860 & 0 & 1 & \multicolumn{2}{c}{(reference)} \\ 
\multicolumn{1}{r}{ \em TRUE }  & $    0.140 $ & $ 0.007 $ & $ 1.007 $ & $ 0.086 $\\ 
I(year - 1920)  & $     3.217  $ & $  -0.023  $ & $  0.977  $ & $  0.002  $ & $ 0.000 $ \\ 
\hline 
Events &  1914  & TTR &  45958 \\ 
Max. logLik. & $  -20498  $ \\ \hline 
\hline 
\end{tabular}

## Interactions postneonatal, summer

Interactions between socst and expTemp:

\includegraphics[width=0.8\textwidth]{figs/plotscs-1.pdf}

Interactions between socst and marginTemp:

\includegraphics[width=0.8\textwidth]{figs/plotsws-1.pdf}

## Neonatal mortality, winter

\begin{center} 
\footnotesize 
\begin{tabular}{lrrrrr} 
\hline 
\bf Covariate & \bf Mean & \bf Coef & \bf H.R. & \bf S.E. &   \bf L-R p \\ \hline
\empp{expTemp}  & $    -3.771  $ & $  -0.013  $ & \empp{$  0.987  $} & $  0.005  $ & $ 0.007 $ \\ 
\empp{marginTemp}  & $    -0.026  $ & $  -0.011  $ & \empp{$  0.989  $} & $  0.005  $ & $ 0.039 $ \\ 
\empp{socst}  & & & & & 0.384  \\ 
\multicolumn{1}{r}{\em highWhiteC} &    0.029 & 0 & 1 & \multicolumn{2}{c}{(reference)} \\ 
\multicolumn{1}{r}{ \em farmer }  & $    0.471 $ & $ -0.076 $ & $ 0.927 $ & $ 0.158 $\\ 
\multicolumn{1}{r}{ \em lowWhiteC }  & $    0.076 $ & $ -0.170 $ & $ 0.844 $ & $ 0.177 $\\ 
\multicolumn{1}{r}{ \em qualWorker }  & $    0.130 $ & $ 0.063 $ & $ 1.065 $ & $ 0.162 $\\ 
\multicolumn{1}{r}{ \em worker }  & $    0.270 $ & $ -0.037 $ & $ 0.964 $ & $ 0.159 $\\ 
\multicolumn{1}{r}{ \em none }  & $    0.024 $ & $ -0.010 $ & $ 0.990 $ & $ 0.210 $\\ 
urban  & & & & & 0.571  \\ 
\multicolumn{1}{r}{\em FALSE} &    0.863 & 0 & 1 & \multicolumn{2}{c}{(reference)} \\ 
\multicolumn{1}{r}{ \em TRUE }  & $    0.137 $ & $ -0.047 $ & $ 0.954 $ & $ 0.084 $\\ 
I(year - 1920)  & $     2.104  $ & $  -0.015  $ & $  0.986  $ & $  0.002  $ & $ 0.000 $ \\ 
\hline 
Events &  1806  & TTR &  3899 \\ 
Max. logLik. & $  -19493  $ \\ \hline 
\hline 
\end{tabular}
\normalsize 
\end{center} 

## Interactions neonatal, winter

\begin{center}
Between socst and expTemp:

\includegraphics[width=0.8\textwidth]{figs/plotwcsn-1.pdf}

Between socst and marginTemp:

\includegraphics[width=0.8\textwidth]{figs/plotwwsn-1.pdf}

\end{center}

## Neonatal mortality, summer

\begin{center} 
\footnotesize 
\begin{tabular}{lrrrrr} 
\hline 
\bf Covariate & \bf Mean & \bf Coef & \bf H.R. & \bf S.E. &   \bf L-R p \\ \hline
expTemp  & $     9.416  $ & $  -0.008  $ & $  0.992  $ & $  0.004  $ & $ 0.056 $ \\ 
marginTemp  & $     0.019  $ & $  0.007  $ & $  1.007  $ & $  0.011  $ & $ 0.498 $ \\ 
socst  & & & & & 0.098  \\ 
\multicolumn{1}{r}{\em highWhiteC} &    0.029 & 0 & 1 & \multicolumn{2}{c}{(reference)} \\ 
\multicolumn{1}{r}{ \em farmer }  & $    0.460 $ & $ 0.329 $ & $ 1.389 $ & $ 0.191 $\\ 
\multicolumn{1}{r}{ \em lowWhiteC }  & $    0.078 $ & $ 0.209 $ & $ 1.232 $ & $ 0.207 $\\ 
\multicolumn{1}{r}{ \em qualWorker }  & $    0.135 $ & $ 0.321 $ & $ 1.379 $ & $ 0.196 $\\ 
\multicolumn{1}{r}{ \em worker }  & $    0.272 $ & $ 0.265 $ & $ 1.304 $ & $ 0.192 $\\ 
\multicolumn{1}{r}{ \em none }  & $    0.026 $ & $ 0.588 $ & $ 1.800 $ & $ 0.227 $\\ 
urban  & & & & & 0.030  \\ 
\multicolumn{1}{r}{\em FALSE} &    0.860 & 0 & 1 & \multicolumn{2}{c}{(reference)} \\ 
\multicolumn{1}{r}{ \em TRUE }  & $    0.140 $ & $ -0.190 $ & $ 0.827 $ & $ 0.089 $\\ 
I(year - 1920)  & $     2.960  $ & $  -0.012  $ & $  0.988  $ & $  0.002  $ & $ 0.000 $ \\ 
\hline 
Events &  1689  & TTR &  4026 \\ 
Max. logLik. & $  -18304  $ \\ \hline 
\hline 
\end{tabular}
\normalsize 
\end{center} 

## Interactions, neonatal, summer

\begin{center}
Between socst and expTemp:

\includegraphics[width=0.8\textwidth]{figs/plotscsn-1.pdf}

Between socst and marginTemp:

\includegraphics[width=0.8\textwidth]{figs/plotswsn-1.pdf}

\end{center}

## Infant mortality  hazard function

\includegraphics[width = \textwidth]{figs/ph-1.pdf}

## Postneonatal hazard function

\includegraphics[width=\textwidth]{figs/phneo-1.pdf}

## A Weibull approximation

\includegraphics[width=\textwidth]{figs/weib-1.pdf}

## Endogenous and exogenous neonatal mortality

\includegraphics[width=\textwidth]{figs/neowei-1.pdf}

Jean \emp{Bourgeois-Pichat} (1951, 1952) would be pleased!

(The "biometric" model)

## Conclusions

*   \emp{Season} ("expected" temperature, *climate*) more \emp{important} than deviations from it.
*   \emp{Sensitivity} to temperature levels and variations \emp{do not vary} much by social class
but is \emp{stronger during winter} than during summer.
*   The \emp{most privileged} are 
    +   \emp{well prepared} for variation in \emp{climate}, but 
    +   more \emp{like the others} when it comes to \emp{unexpected cold} weather during winter. 
